<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸ‡®ðŸ‡³ Tiranga Registration Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Google Sans', 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 760px;
      margin: 0 auto;
    }
    
    /* Header Section */
    .form-header {
      background: white;
      border-radius: 12px;
      padding: 40px 30px;
      margin-bottom: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-top: 10px solid;
      border-image: linear-gradient(90deg, #FF9933, #FFFFFF, #138808) 1;
    }
    .form-header h1 {
      font-size: 2.2em;
      color: #202124;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .form-header p {
      color: #5f6368;
      font-size: 1em;
      line-height: 1.5;
    }
    
    /* Section Cards */
    .section {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-left: 6px solid #667eea;
    }
    .section.hidden {
      display: none;
    }
    
    .section-title {
      font-size: 1.5em;
      color: #202124;
      margin-bottom: 8px;
      font-weight: 500;
    }
    .section-description {
      color: #5f6368;
      font-size: 0.95em;
      margin-bottom: 25px;
      line-height: 1.5;
    }
    
    /* Form Elements */
    .form-group {
      margin-bottom: 28px;
    }
    .form-group:last-child {
      margin-bottom: 0;
    }
    
    label {
      display: block;
      color: #202124;
      font-size: 1em;
      margin-bottom: 8px;
      font-weight: 500;
    }
    .required {
      color: #d93025;
      margin-left: 2px;
    }
    
    input[type="text"],
    input[type="tel"],
    input[type="email"] {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid #dadce0;
      border-radius: 8px;
      font-size: 1em;
      font-family: inherit;
      transition: all 0.2s;
      background: white;
    }
    input[type="text"]:hover,
    input[type="tel"]:hover,
    input[type="email"]:hover {
      border-color: #202124;
    }
    input[type="text"]:focus,
    input[type="tel"]:focus,
    input[type="email"]:focus {
      outline: none;
      border-color: #1a73e8;
      box-shadow: 0 1px 2px rgba(26,115,232,0.3);
    }
    
    input[type="file"] {
      display: none;
    }
    .file-upload-wrapper {
      position: relative;
    }
    .file-upload-label {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 24px;
      background: #1a73e8;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }
    .file-upload-label:hover {
      background: #1765cc;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .file-name {
      display: inline-block;
      margin-left: 12px;
      color: #5f6368;
      font-size: 0.9em;
    }
    
    /* Tab Selection */
    .tabs-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 30px;
    }
    .tab-option {
      padding: 14px 12px;
      border: 2px solid #dadce0;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      text-align: center;
      font-size: 0.9em;
      font-weight: 500;
      color: #202124;
      transition: all 0.2s;
    }
    .tab-option:hover {
      border-color: #1a73e8;
      background: #f1f3f4;
    }
    .tab-option.selected {
      background: #1a73e8;
      color: white;
      border-color: #1a73e8;
    }
    
    /* Events Grid */
    .events-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
    }
    
    .event-card {
      border: 2px solid #dadce0;
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
    }
    .event-card:hover {
      border-color: #1a73e8;
      box-shadow: 0 2px 8px rgba(26,115,232,0.2);
      transform: translateY(-2px);
    }
    .event-card.selected {
      border-color: #34a853;
      background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
      box-shadow: 0 3px 10px rgba(52,168,83,0.25);
    }
    
    .event-name {
      font-size: 1em;
      font-weight: 500;
      color: #202124;
      margin-bottom: 10px;
      line-height: 1.4;
    }
    .event-price {
      font-size: 1.4em;
      font-weight: 700;
      color: #1a73e8;
      margin-bottom: 12px;
    }
    .event-card.selected .event-price {
      color: #34a853;
    }
    
    .participant-section {
      border-top: 2px dashed #dadce0;
      padding-top: 12px;
      margin-top: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .participant-label {
      font-size: 0.9em;
      color: #5f6368;
      flex-shrink: 0;
    }
    .participant-input {
      flex: 1;
      padding: 10px;
      border: 2px solid #dadce0;
      border-radius: 8px;
      text-align: center;
      font-size: 1.1em;
      font-weight: 600;
      color: #202124;
    }
    .participant-input:focus {
      outline: none;
      border-color: #34a853;
    }
    .event-card.selected .participant-input {
      border-color: #34a853;
      background: white;
    }
    
    /* Summary Box */
    .summary-section {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      padding: 25px;
      border-radius: 12px;
      border: 2px solid #dadce0;
    }
    .summary-title {
      font-size: 1.3em;
      color: #202124;
      margin-bottom: 20px;
      font-weight: 500;
    }
    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #dadce0;
    }
    .summary-row:last-child {
      border-bottom: none;
    }
    .summary-label {
      color: #5f6368;
      font-weight: 500;
    }
    .summary-value {
      color: #202124;
      font-weight: 600;
      font-size: 1.1em;
    }
    .summary-total {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 3px solid #34a853;
    }
    .summary-total .summary-value {
      font-size: 2em;
      color: #34a853;
    }
    
    /* QR Code Section */
    .qr-section {
      text-align: center;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 12px;
      margin-bottom: 25px;
    }
    .qr-title {
      font-size: 1.2em;
      color: #202124;
      margin-bottom: 15px;
      font-weight: 500;
    }
    .qr-wrapper {
      width: 240px;
      height: 240px;
      margin: 0 auto;
      border: 3px dashed #dadce0;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
    }
    .qr-wrapper img {
      max-width: 90%;
      max-height: 90%;
    }
    .qr-note {
      margin-top: 15px;
      color: #5f6368;
      font-size: 0.9em;
    }
    
    /* Buttons */
    .button-group {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      margin-top: 25px;
    }
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }
    .btn-secondary {
      background: white;
      color: #1a73e8;
      border: 2px solid #1a73e8;
    }
    .btn-secondary:hover {
      background: #f1f3f4;
    }
    .btn-primary {
      background: #1a73e8;
      color: white;
    }
    .btn-primary:hover {
      background: #1765cc;
      box-shadow: 0 2px 8px rgba(26,115,232,0.3);
    }
    .btn-primary:disabled {
      background: #dadce0;
      cursor: not-allowed;
    }
    .btn-success {
      background: #34a853;
      color: white;
      width: 100%;
      padding: 16px;
      font-size: 1.1em;
    }
    .btn-success:hover:not(:disabled) {
      background: #2d8e47;
      box-shadow: 0 3px 10px rgba(52,168,83,0.3);
    }
    
    /* Messages */
    .error-msg {
      display: none;
      background: #fce8e6;
      color: #d93025;
      padding: 14px 18px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #d93025;
      font-size: 0.95em;
    }
    .info-banner {
      background: #e8f0fe;
      color: #1967d2;
      padding: 14px 18px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #1a73e8;
      font-size: 0.95em;
      line-height: 1.5;
    }
    
    /* Loading & Success */
    .loading-overlay,
    .success-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255,255,255,0.95);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .loading-content,
    .success-content {
      text-align: center;
      padding: 40px;
    }
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 6px solid #f3f3f3;
      border-top: 6px solid #1a73e8;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .success-icon {
      font-size: 4em;
      margin-bottom: 20px;
    }
    .success-content h2 {
      font-size: 2em;
      color: #34a853;
      margin-bottom: 15px;
    }
    .success-content p {
      color: #5f6368;
      font-size: 1.1em;
      margin-bottom: 25px;
    }
    
    @media (max-width: 768px) {
      .container { padding: 10px; }
      .form-header, .section { padding: 25px 20px; }
      .section-title { font-size: 1.3em; }
      .tabs-container { grid-template-columns: repeat(2, 1fr); }
      .events-grid { grid-template-columns: 1fr; }
      .button-group { flex-direction: column; }
      .btn-secondary, .btn-primary { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="form-header">
      <h1><span>ðŸ‡®ðŸ‡³</span> Tiranga Event Registration</h1>
      <p>Register your school for cultural events by grade level</p>
    </div>

    <!-- Section 1: School Information -->
    <div class="section" id="section1">
      <h2 class="section-title">1. School Information</h2>
      <p class="section-description">Please provide your school's contact details</p>
      
      <div class="error-msg" id="errorMsg1"></div>
      
      <div class="form-group">
        <label>School Name <span class="required">*</span></label>
        <input type="text" id="schoolName" placeholder="Enter your school name" required>
      </div>

      <div class="form-group">
        <label>Contact Number <span class="required">*</span></label>
        <input type="tel" id="contact" placeholder="+91 XXXXX XXXXX" required>
      </div>

      <div class="form-group">
        <label>Email Address <span class="required">*</span></label>
        <input type="email" id="email" placeholder="school@example.com" required>
      </div>

      <div class="button-group">
        <button class="btn btn-primary" onclick="goToSection(2)">Next</button>
      </div>
    </div>

    <!-- Section 2: Event Selection -->
    <div class="section hidden" id="section2">
      <h2 class="section-title">2. Event Selection</h2>
      <p class="section-description">Select your grade level and choose events</p>
      
      <div class="error-msg" id="errorMsg2"></div>
      
      <div class="form-group">
        <label>Select Grade Level <span class="required">*</span></label>
        <div class="tabs-container" id="gradeSelector">
          <div class="tab-option" data-tab="preprimary">Pre-Primary</div>
          <div class="tab-option" data-tab="grade1">Grade I</div>
          <div class="tab-option" data-tab="grade2">Grade II</div>
          <div class="tab-option" data-tab="grade3">Grade III</div>
          <div class="tab-option" data-tab="grade4">Grade IV</div>
          <div class="tab-option" data-tab="grade5">Grade V</div>
          <div class="tab-option" data-tab="grade6">Grade VI</div>
          <div class="tab-option" data-tab="grade7">Grade VII</div>
          <div class="tab-option" data-tab="grade8">Grade VIII</div>
          <div class="tab-option" data-tab="grade9">Grade IX-XII</div>
          <div class="tab-option" data-tab="combined">Grades VI-XII</div>
        </div>
      </div>

      <div class="form-group" id="eventsContainer" style="display:none;">
        <label>Select Events & Enter Participants <span class="required">*</span></label>
        <p style="color: #5f6368; font-size: 0.9em; margin-bottom: 15px;">Click on events to select them, then specify the number of participants</p>
        <div class="events-grid" id="eventsGrid"></div>
      </div>

      <div class="button-group">
        <button class="btn btn-secondary" onclick="goToSection(1)">Back</button>
        <button class="btn btn-primary" onclick="goToSection(3)">Next</button>
      </div>
    </div>

    <!-- Section 3: Payment Details -->
    <div class="section hidden" id="section3">
      <h2 class="section-title">3. Payment & Summary</h2>
      <p class="section-description">Review your registration and complete payment</p>
      
      <div class="error-msg" id="errorMsg3"></div>
      
      <!-- Summary -->
      <div class="summary-section">
        <h3 class="summary-title">Registration Summary</h3>
        <div class="summary-row">
          <span class="summary-label">School Name:</span>
          <span class="summary-value" id="summarySchool">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Selected Events:</span>
          <span class="summary-value" id="summaryEvents">0</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Total Participants:</span>
          <span class="summary-value" id="summaryParticipants">0</span>
        </div>
        <div class="summary-row summary-total">
          <span class="summary-label">Total Amount:</span>
          <span class="summary-value" id="summaryAmount">â‚¹0</span>
        </div>
      </div>

      <!-- Payment QR -->
      <div class="qr-section">
        <h3 class="qr-title">ðŸ’³ Scan to Pay</h3>
        <div class="qr-wrapper">
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=UPI%3Ayourupiid%40paytm" alt="Payment QR Code">
        </div>
        <p class="qr-note">Scan the QR code above to make payment</p>
      </div>

      <!-- Payment Details -->
      <div class="form-group">
        <label>Transaction ID / UTR Number <span class="required">*</span></label>
        <input type="text" id="transactionId" placeholder="Enter transaction ID after payment" required>
      </div>

      <div class="form-group">
        <label>Upload Payment Screenshot <span class="required">*</span></label>
        <div class="file-upload-wrapper">
          <input type="file" id="paymentProof" accept="image/*,.pdf" required>
          <label for="paymentProof" class="file-upload-label">
            <span>ðŸ“Ž</span>
            <span>Choose File</span>
          </label>
          <span class="file-name" id="fileName"></span>
        </div>
      </div>

      <div class="button-group">
        <button class="btn btn-secondary" onclick="goToSection(2)">Back</button>
        <button class="btn btn-success" id="submitBtn" onclick="submitForm()">Submit Registration</button>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <h3>Submitting Your Registration...</h3>
      <p>Please wait, do not close this page</p>
    </div>
  </div>

  <!-- Success Overlay -->
  <div class="success-overlay" id="successOverlay">
    <div class="success-content">
      <div class="success-icon">âœ…</div>
      <h2>Registration Successful!</h2>
      <p>Your registration has been submitted. Check your email for confirmation.</p>
      <button class="btn btn-primary" onclick="location.reload()">Register Another School</button>
    </div>
  </div>

  <script>
    // âš ï¸ REPLACE WITH YOUR ACTUAL WEB APP URL AFTER DEPLOYMENT
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzUs7vsnHajb4z2Z-WE5wlDBvLH4LOG_E6qrVC4tq7R5rf-hjiaDg5W129qTwOyoG32tg/exec';

    const allEvents = {
      preprimary: [
        {name:'Happy feet - Solo',price:300},
        {name:'Innocence in paint - Solo',price:300},
        {name:'Whats in my bag? - Solo',price:300},
        {name:'Moudling minds - Solo',price:300}
      ],
      grade1: [
        {name:'Soul Speaks - Solo',price:300},
        {name:'India Icons - Solo',price:300},
        {name:'Pieces to picture',price:300}
      ],
      grade2: [
        {name:'Soul Speaks - Solo',price:300},
        {name:'India Icons - Solo',price:300},
        {name:'Pieces to picture - Solo',price:300}
      ],
      grade3: [
        {name:'Two minute Tale-Mini Theatre - Solo',price:300},
        {name:'A cultural MASCOT - Group(2 Persons)',price:500},
        {name:'ECO Hero - Solo',price:300},
        {name:'dance with a prop - Solo',price:300},
        {name:'two minute medley - Solo',price:300}
      ],
      grade4: [
        {name:'Two minute Tale-Mini Theatre - Solo',price:300},
        {name:'A cultural MASCOT - Group(2 Persons)',price:500},
        {name:'ECO Hero - Solo',price:300},
        {name:'dance with a prop - Solo',price:300},
        {name:'two minute medley - Solo',price:300}
      ],
      grade5: [
        {name:'Two minute Tale-Mini Theatre - Solo',price:300},
        {name:'A cultural MASCOT - Group(2 Persons)',price:500},
        {name:'ECO Hero - Solo',price:300},
        {name:'dance with a prop - Solo',price:300},
        {name:'two minute medley - Solo',price:300},
        {name:'States and their suprises - Group(2 Persons)',price:500}
      ],
      grade6: [
        {name:'Gadget World - Solo',price:300},
        {name:'Vibrant Visage - Group(2 Persons)',price:500},
        {name:'Tech based triumph - Group(2 Persons)',price:500},
        {name:'Dream Design Do - Solo',price:300},
        {name:'60 second spotlight- picture based - Solo',price:300},
        {name:'Rhythm Rumble - Solo',price:300},
        {name:'two minute medley - Solo',price:300},
        {name:'Upscaled Art Flow - Group(2 Persons)',price:500},
        {name:'States and their suprises - Group(2 Persons)',price:500}
      ],
      grade7: [
        {name:'Gadget World - Solo',price:300},
        {name:'Vibrant Visage - Group(2 Persons)',price:500},
        {name:'Tech based triumph - Group(2 Persons)',price:500},
        {name:'Dream Design Do - Solo',price:300},
        {name:'60 second spotlight- picture based - Solo',price:300},
        {name:'Rhythm Rumble - Solo',price:300},
        {name:'two minute medley - Solo',price:300},
        {name:'Upscaled Art Flow - Group(2 Persons)',price:500}
      ],
      grade8: [
        {name:'Gadget World - Solo',price:300},
        {name:'Vibrant Visage - Group(2 Persons)',price:500},
        {name:'Tech based triumph - Group(2 Persons)',price:500},
        {name:'Dream Design Do - Solo',price:300},
        {name:'60 second spotlight- picture based - Solo',price:300},
        {name:'Rhythm Rumble - Solo',price:300},
        {name:'two minute medley - Solo',price:300},
        {name:'Upscaled Art Flow - Group(2 Persons)',price:500}
      ],
      grade9: [
        {name:'Inventia - Group(2-3 Persons)',price:500},
        {name:'Pitch Bharath - Group(3-4 Persons)',price:500},
        {name:'Reflection through moments - Group(2 Persons)',price:500},
        {name:'Culture Carnival - Group(5 Persons)',price:500},
        {name:'Digital Arena - Group(3-4 Persons)',price:500},
        {name:'Path Finder - Solo',price:300},
        {name:'Echoes of Eloquence - Solo',price:300},
        {name:'Binary Battle - Solo',price:300},
        {name:'Rhythm Rumble - Solo',price:300},
        {name:'Discovery Files - Group(2-4 Persons)',price:500},
        {name:'Unplugged voices - Solo',price:300},
        {name:'Meme to Motion',price:300}
      ],
      combined: [
        {name:'Swirl and Twirl - Group(5-10 Persons)',price:800},
        {name:'Sovereignity Symphony - Group(5-12 Persons)',price:800},
        {name:'From Films to Fashion - Solo',price:300},
        {name:'Flash ad - Group(3-4 Persons)',price:500}
      ]
    };

    let currentSection = 1;
    let selectedGrade = '';
    let selectedEvents = [];
    let eventParticipants = {};

    const gradeNames = {
      'preprimary': 'Pre-Primary',
      'grade1': 'Grade I',
      'grade2': 'Grade II',
      'grade3': 'Grade III',
      'grade4': 'Grade IV',
      'grade5': 'Grade V',
      'grade6': 'Grade VI',
      'grade7': 'Grade VII',
      'grade8': 'Grade VIII',
      'grade9': 'Grade IX-XII',
      'combined': 'Grades VI-XII'
    };

    // Section Navigation
    function goToSection(section) {
      // Validate current section
      if (section > currentSection) {
        if (currentSection === 1 && !validateSection1()) return;
        if (currentSection === 2 && !validateSection2()) return;
      }

      // Hide all sections
      for (let i = 1; i <= 3; i++) {
        document.getElementById(`section${i}`).classList.add('hidden');
      }

      // Show target section
      document.getElementById(`section${section}`).classList.remove('hidden');
      currentSection = section;

      // Update summary if going to section 3
      if (section === 3) {
        updateSummary();
      }

      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Validation
    function validateSection1() {
      const schoolName = document.getElementById('schoolName').value.trim();
      const contact = document.getElementById('contact').value.trim();
      const email = document.getElementById('email').value.trim();

      if (!schoolName) {
        showError(1, 'Please enter school name');
        return false;
      }
      if (!contact) {
        showError(1, 'Please enter contact number');
        return false;
      }
      if (!email || !email.includes('@')) {
        showError(1, 'Please enter a valid email address');
        return false;
      }
      return true;
    }

    function validateSection2() {
      if (!selectedGrade) {
        showError(2, 'Please select a grade level');
        return false;
      }
      if (selectedEvents.length === 0) {
        showError(2, 'Please select at least one event');
        return false;
      }
      const totalParticipants = Object.values(eventParticipants).reduce((sum, count) => sum + (count || 0), 0);
      if (totalParticipants === 0) {
        showError(2, 'Please enter the number of participants for selected events');
        return false;
      }
      return true;
    }

    function showError(section, message) {
      const errorMsg = document.getElementById(`errorMsg${section}`);
      errorMsg.textContent = message;
      errorMsg.style.display = 'block';
      errorMsg.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      setTimeout(() => {
        errorMsg.style.display = 'none';
      }, 5000);
    }

    // Grade Selection
    document.querySelectorAll('.tab-option').forEach(tab => {
      tab.addEventListener('click', function() {
        document.querySelectorAll('.tab-option').forEach(t => t.classList.remove('selected'));
        this.classList.add('selected');
        selectedGrade = this.getAttribute('data-tab');
        loadEvents();
      });
    });

    // Load Events
    function loadEvents() {
      const grid = document.getElementById('eventsGrid');
      const container = document.getElementById('eventsContainer');
      
      grid.innerHTML = allEvents[selectedGrade].map(event => {
        const id = 'event_' + event.name.toLowerCase().replace(/[^a-z0-9]/g, '_');
        const isSelected = selectedEvents.some(e => e.name === event.name);
        const participants = eventParticipants[event.name] || 1;
        
        return `
          <div class="event-card ${isSelected ? 'selected' : ''}" data-event="${event.name}" onclick="toggleEvent('${event.name}')">
            <div class="event-name">${event.name}</div>
            <div class="event-price">â‚¹${event.price}</div>
            <div class="participant-section" style="${isSelected ? '' : 'display:none;'}" id="participants_${id}">
              <span class="participant-label">Participants:</span>
              <input 
                type="number" 
                id="${id}" 
                class="participant-input"
                min="1" 
                max="50" 
                value="${participants}"
                onclick="event.stopPropagation()"
                onchange="updateParticipants('${event.name}', this.value)"
              >
            </div>
          </div>
        `;
      }).join('');
      
      container.style.display = 'block';
    }

    // Toggle Event Selection
    function toggleEvent(eventName) {
      const event = allEvents[selectedGrade].find(e => e.name === eventName);
      const index = selectedEvents.findIndex(e => e.name === eventName);
      const id = 'event_' + eventName.toLowerCase().replace(/[^a-z0-9]/g, '_');
      
      if (index > -1) {
        selectedEvents.splice(index, 1);
        delete eventParticipants[eventName];
      } else {
        selectedEvents.push(event);
        eventParticipants[eventName] = 1;
      }
      
      loadEvents();
    }

    // Update Participants
    function updateParticipants(eventName, value) {
      eventParticipants[eventName] = parseInt(value) || 1;
    }

    // Update Summary
    function updateSummary() {
      document.getElementById('summarySchool').textContent = document.getElementById('schoolName').value;
      document.getElementById('summaryGrade').textContent = gradeNames[selectedGrade];
      document.getElementById('summaryEvents').textContent = selectedEvents.length;
      
      const totalParticipants = Object.values(eventParticipants).reduce((sum, count) => sum + (count || 0), 0);
      document.getElementById('summaryParticipants').textContent = totalParticipants;
      
      const totalAmount = selectedEvents.reduce((sum, event) => {
        return sum + (event.price * (eventParticipants[event.name] || 0));
      }, 0);
      document.getElementById('summaryAmount').textContent = `â‚¹${totalAmount.toLocaleString()}`;
    }

    // File Upload
    document.getElementById('paymentProof').addEventListener('change', function() {
      const fileName = this.files[0]?.name || '';
      document.getElementById('fileName').textContent = fileName ? `Selected: ${fileName}` : '';
    });

    // Upload File
    async function uploadFileToDrive(file) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = async (e) => {
          try {
            const response = await fetch(APPS_SCRIPT_URL, {
              method: 'POST',
              headers: {'Content-Type': 'application/x-www-form-urlencoded'},
              body: new URLSearchParams({
                action: 'upload',
                data: e.target.result.split(',')[1],
                mimetype: file.type,
                filename: file.name
              })
            });
            const result = await response.text();
            resolve(result);
          } catch (error) {
            console.error('Upload error:', error);
            resolve(file.name);
          }
        };
        reader.readAsDataURL(file);
      });
    }

    // Submit Form
    async function submitForm() {
      const transactionId = document.getElementById('transactionId').value.trim();
      const paymentProof = document.getElementById('paymentProof').files[0];

      if (!transactionId) {
        showError(3, 'Please enter transaction ID');
        return;
      }
      if (!paymentProof) {
        showError(3, 'Please upload payment screenshot');
        return;
      }

      const submitBtn = document.getElementById('submitBtn');
      const loadingOverlay = document.getElementById('loadingOverlay');
      const successOverlay = document.getElementById('successOverlay');

      submitBtn.disabled = true;
      loadingOverlay.style.display = 'flex';

      try {
        const fileUrl = await uploadFileToDrive(paymentProof);
        
        const eventDetails = {};
        selectedEvents.forEach(event => {
          const participants = eventParticipants[event.name] || 0;
          if (participants > 0) {
            eventDetails[event.name] = {
              participants: participants,
              price: event.price,
              total: event.price * participants
            };
          }
        });
        
        const totalAmount = selectedEvents.reduce((sum, event) => {
          return sum + (event.price * (eventParticipants[event.name] || 0));
        }, 0);
        
        const formData = {
          action: 'submit',
          schoolName: document.getElementById('schoolName').value.trim(),
          contact: document.getElementById('contact').value.trim(),
          email: document.getElementById('email').value.trim(),
          transactionId: transactionId,
          selectedGrade: selectedGrade,
          eventDetails: eventDetails,
          totalAmount: totalAmount,
          fileUrl: fileUrl
        };

        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(formData)
        });

        const result = await response.text();
        if (result.includes('SUCCESS')) {
          loadingOverlay.style.display = 'none';
          successOverlay.style.display = 'flex';
        } else {
          throw new Error(result);
        }
      } catch (error) {
        showError(3, 'Submission failed: ' + error.message);
        loadingOverlay.style.display = 'none';
        submitBtn.disabled = false;
      }
    }
  </script>
</body>
</html>
